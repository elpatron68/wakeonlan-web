version: "3.8"

services:
    wakeonlan-web:
        image: fluidblue/wakeonlan-web:latest
        build:
            context: .
            dockerfile: Dockerfile
        init: true
        restart: always
        environment:
            PORT: "9000"
            DATABASE_HOST: "mariadb"
            DATABASE_DB: "${DATABASE_DB}"
            DATABASE_USER: "${DATABASE_USER}"
            DATABASE_PASSWORD_FILE: "${DATABASE_PASSWORD_FILE_CONTAINER}"
        ports:
            - "9000:9000"
        volumes:
            - ${DATABASE_PASSWORD_FILE_LOCAL}:${DATABASE_PASSWORD_FILE_CONTAINER}
        logging:
            driver: "json-file"
            options:
                max-size: "20m"
                max-file: "5"

    mariadb:
        image: mariadb:10.6
        restart: always
        environment:
            MARIADB_RANDOM_ROOT_PASSWORD: "yes"
            MARIADB_DATABASE: "${DATABASE_DB}"
            MARIADB_USER: "${DATABASE_USER}"
            MARIADB_PASSWORD_FILE: "${DATABASE_PASSWORD_FILE_CONTAINER}"
        ports:
            - "3306:3306"
        volumes:
            - mariadb-data:/var/lib/mysql
            - ${DATABASE_PASSWORD_FILE_LOCAL}:${DATABASE_PASSWORD_FILE_CONTAINER}
            - ./db.sql:/docker-entrypoint-initdb.d/db.sql
        logging:
            driver: "json-file"
            options:
                max-size: "20m"
                max-file: "5"

    adminer:
        image: adminer
        restart: always
        ports:
            - "8080:8080"

volumes:
    mariadb-data:
